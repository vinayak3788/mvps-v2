import{r as c,c as y,j as r,V as o,k as x,s as v,d as w}from"./vendor-JV4b0bO8.js";import{a as i,g as j}from"./index-DwOsTwTZ.js";import{L as k,B as N}from"./Button-C4S57wnW.js";function E(){const[d,f]=c.useState(""),[m,p]=c.useState(""),[u,n]=c.useState(!1),t=y();c.useEffect(()=>{let e;const s=()=>{clearTimeout(e),e=setTimeout(()=>{i.signOut(),o("Session expired. You’ve been logged out."),t("/login")},18e5)},a=["mousemove","keydown","click"];return a.forEach(l=>window.addEventListener(l,s)),s(),()=>{a.forEach(l=>window.removeEventListener(l,s)),clearTimeout(e)}},[t]);const g=async e=>{var s;if(e==="vinayak3788@gmail.com")return!0;try{const{data:a}=await w.get(`/api/get-profile?email=${encodeURIComponent(e)}`);return a.blocked?(o.error("Your account has been blocked. Contact admin."),await i.signOut(),!1):[1,"1",!0].includes(a.mobileVerified)?(localStorage.setItem("username",a.name||e),!0):(o.error("Please verify your mobile number."),t("/verify-mobile"),!1)}catch(a){return console.error("Error fetching profile:",a),((s=a.response)==null?void 0:s.status)===404?(o.error("No account found. Please sign up first."),await i.signOut(),t("/signup")):(o.error("Server error. Try again later."),await i.signOut()),!1}},h=async e=>{e.preventDefault(),n(!0);try{const s=await x(i,d,m);await g(s.user.email)&&(o.success("Welcome back!"),t("/userdashboard"))}catch(s){console.error("Login error:",s),o.error("Login failed. Please check your credentials.")}finally{n(!1)}},b=async()=>{n(!0);try{const e=await v(i,j);await g(e.user.email)&&(o.success("Welcome back!"),t("/userdashboard"))}catch(e){console.error("Google popup sign-in error:",e),o.error("Google sign-in failed. Please try again.")}finally{n(!1)}};return r.jsxs(k,{title:"Log In to MVP Services",maxWidth:"max-w-md",children:[r.jsxs("form",{onSubmit:h,className:"space-y-4",autoComplete:"off",spellCheck:"false",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block mb-1 font-medium",children:"Email"}),r.jsx("input",{type:"email",name:"email",value:d,autoComplete:"off",onChange:e=>f(e.target.value),required:!0,className:"w-full border border-gray-300 px-3 py-2 rounded-md focus:ring-2 focus:ring-purple-500"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block mb-1 font-medium",children:"Password"}),r.jsx("input",{type:"password",name:"password",value:m,onChange:e=>p(e.target.value),required:!0,className:"w-full border border-gray-300 px-3 py-2 rounded-md focus:ring-2 focus:ring-purple-500"})]}),r.jsx(N,{type:"submit",disabled:u,className:"w-full",children:u?"Signing in…":"Log In"})]}),r.jsx("div",{className:"text-center font-semibold my-6",children:"OR"}),r.jsxs("button",{onClick:b,disabled:u,className:"w-full flex items-center justify-center border border-gray-300 bg-white px-4 py-2 rounded-md hover:bg-gray-100 disabled:opacity-50 transition",children:[r.jsx("img",{src:"/google-logo.svg",alt:"Google",className:"w-5 h-5 mr-2"}),"Sign in with Google"]}),r.jsxs("p",{className:"mt-6 text-center text-sm",children:["Don’t have an account?"," ",r.jsx("button",{onClick:()=>t("/signup"),className:"text-purple-600 font-medium underline",children:"Sign Up"})]})]})}export{E as default};
