import{d as u,c as x,r as o,j as s,V as t}from"./vendor-JV4b0bO8.js";import{a as f}from"./index-DwOsTwTZ.js";import{g as v}from"./userApi-BvSZO4a6.js";import{L as O,B as g}from"./Button-C4S57wnW.js";const j=async r=>(await u.post("/api/send-otp",{mobileNumber:r},{headers:{"Content-Type":"application/json"}})).data,w=async(r,a)=>(await u.post("/api/verify-otp",{sessionId:r,otp:a},{headers:{"Content-Type":"application/json"}})).data;function C(){const r=x(),[a,d]=o.useState(""),[p,m]=o.useState(""),[c,y]=o.useState(""),[l,n]=o.useState(!1);o.useEffect(()=>{(async()=>{const e=f.currentUser;if(!e){r("/login",{replace:!0});return}try{const{mobileVerified:i}=await v(e.email);i&&r("/userdashboard",{replace:!0})}catch(i){console.error("Profile check failed:",i)}})()},[r]);const b=async()=>{if(!/^\d{10}$/.test(a)){t.error("Enter a valid 10-digit mobile number.");return}n(!0);try{const{sessionId:e}=await j(a);m(e),t.success("OTP sent successfully!")}catch{t.error("Failed to send OTP.")}finally{n(!1)}},h=async()=>{if(!/^\d{6}$/.test(c)){t.error("Enter a valid 6-digit OTP.");return}n(!0);try{if(!(await w(p,c)).success){t.error("Incorrect OTP. Try again."),n(!1);return}const i=f.currentUser;await u.post("/api/verify-mobile-manual",{email:i.email}),t.success("Mobile verified successfully!"),r("/userdashboard",{replace:!0})}catch{t.error("OTP verification failed.")}finally{n(!1)}};return s.jsx(O,{title:"Verify Mobile Number",children:p?s.jsxs(s.Fragment,{children:[s.jsx("input",{type:"text",placeholder:"Enter OTP",value:c,onChange:e=>y(e.target.value.replace(/\D/g,"").slice(0,6)),className:"w-full border px-3 py-2 rounded mb-4 focus:ring-2 focus:ring-purple-500"}),s.jsx(g,{onClick:h,disabled:l,className:"w-full bg-green-600 hover:bg-green-700 text-white",children:l?"Verifying…":"Verify & Continue"})]}):s.jsxs(s.Fragment,{children:[s.jsx("input",{type:"text",placeholder:"Enter Mobile Number",value:a,onChange:e=>d(e.target.value.replace(/\D/g,"").slice(0,10)),className:"w-full border px-3 py-2 rounded mb-4 focus:ring-2 focus:ring-purple-500"}),s.jsx(g,{onClick:b,disabled:l,className:"w-full",children:l?"Sending OTP…":"Send OTP"})]})})}export{C as default};
