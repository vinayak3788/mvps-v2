import{j as e,d as U,r as i,V as d,c as L,O as M,l as O}from"./vendor-JV4b0bO8.js";import{a as I}from"./index-DwOsTwTZ.js";import{L as q,B as E}from"./Button-C4S57wnW.js";import{U as Q}from"./UserHeader-C593a15d.js";import{a as R,u as $,b as B,c as K,d as T,v as W,e as _}from"./userApi-BvSZO4a6.js";function J({activeTab:a,setActiveTab:o,fetchOrders:x,fetchUsers:t}){return e.jsxs("nav",{className:"bg-white shadow rounded mb-6 p-4 flex gap-4",children:[e.jsx("button",{className:`px-4 py-2 rounded ${a==="orders"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,onClick:()=>{o("orders"),x()},children:"Manage Orders"}),e.jsx("button",{className:`px-4 py-2 rounded ${a==="users"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,onClick:()=>{o("users"),t()},children:"Manage Users"}),e.jsx("button",{className:`px-4 py-2 rounded ${a==="stationery"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,onClick:()=>o("stationery"),children:"Manage Stationery"})]})}function z({files:a}){if(!a||a.length===0)return e.jsx("div",{className:"text-gray-500",children:"No files uploaded"});const o=async x=>{try{const h=(await U.get(`/api/get-signed-url?filename=${encodeURIComponent(x)}`)).data.url;window.open(h,"_blank")}catch(t){console.error("Failed to fetch signed URL",t),alert("⚠️ File not found or expired.")}};return e.jsx("div",{className:"flex flex-col items-start space-y-1 p-2",children:a.map((x,t)=>e.jsxs("button",{onClick:()=>o(x.name),className:"text-red-600 underline flex items-center space-x-1 hover:text-red-800",children:[e.jsx("span",{role:"img","aria-label":"file",children:"📄"}),e.jsx("span",{children:x.name})]},t))})}function H({orders:a,loading:o,handleStatusChange:x}){return o?e.jsx("div",{className:"text-center p-4",children:"Loading orders..."}):!Array.isArray(a)||a.length===0?e.jsx("div",{className:"text-center",children:"No orders found."}):e.jsx("div",{className:"rounded-xl border border-gray-300 shadow",children:e.jsxs("table",{className:"min-w-full text-sm text-gray-800 whitespace-nowrap",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 border",children:"Order No"}),e.jsx("th",{className:"px-3 py-2 border",children:"User Email"}),e.jsx("th",{className:"px-3 py-2 border",children:"Files"}),e.jsx("th",{className:"px-3 py-2 border",children:"Pages"}),e.jsx("th",{className:"px-3 py-2 border",children:"Options"}),e.jsx("th",{className:"px-3 py-2 border",children:"Total Price"}),e.jsx("th",{className:"px-3 py-2 border",children:"Status"}),e.jsx("th",{className:"px-3 py-2 border",children:"Date"})]})}),e.jsx("tbody",{children:a.map((t,h)=>{var p,u;return e.jsxs("tr",{className:h%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-3 py-1 border text-center font-semibold",children:t.orderNumber}),e.jsx("td",{className:"px-3 py-1 border text-center",children:t.userEmail}),e.jsx("td",{className:"px-3 py-1 border text-center",children:e.jsx(z,{files:Array.isArray(t.attachedFiles)?t.attachedFiles:[]})}),e.jsx("td",{className:"px-3 py-1 border text-center font-mono",children:t.totalPages??"-"}),e.jsxs("td",{className:"px-3 py-1 border text-center",children:[(p=t.printType)==null?void 0:p.toUpperCase()," |"," ",(u=t.sideOption)==null?void 0:u.toUpperCase()," ",t.spiralBinding?"| Spiral":""]}),e.jsxs("td",{className:"px-3 py-1 border text-right font-medium",children:["₹",t.totalCost]}),e.jsx("td",{className:"px-3 py-1 border text-center",children:e.jsxs("select",{value:t.status,onChange:j=>x(t.id,j.target.value),className:"border rounded px-2 py-1 text-sm shadow-sm bg-white",children:[e.jsx("option",{value:"new",children:"🟡 New"}),e.jsx("option",{value:"in process",children:"🟠 In Process"}),e.jsx("option",{value:"ready to deliver",children:"🟢 Ready"})]})}),e.jsx("td",{className:"px-3 py-1 border text-center",children:new Date(t.createdAt).toLocaleString()})]},t.id)})})]})})}function G({users:a,loading:o,handleRoleChange:x,handleBlockUser:t,handleUnblockUser:h,handleDeleteUser:p,handleVerifyMobile:u,setEditUser:j}){return o?e.jsx("div",{className:"text-center p-4",children:"Loading users..."}):a.length?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white border shadow text-sm sm:text-base",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 border",children:"Email"}),e.jsx("th",{className:"px-3 py-2 border",children:"Role"}),e.jsx("th",{className:"px-3 py-2 border",children:"First Name"}),e.jsx("th",{className:"px-3 py-2 border",children:"Last Name"}),e.jsx("th",{className:"px-3 py-2 border",children:"Mobile"}),e.jsx("th",{className:"px-3 py-2 border",children:"Verified"}),e.jsx("th",{className:"px-3 py-2 border",children:"Actions"})]})}),e.jsx("tbody",{children:a.map(l=>e.jsxs("tr",{className:"text-center",children:[e.jsx("td",{className:"px-3 py-2 border break-words",children:l.email}),e.jsx("td",{className:"px-3 py-2 border",children:l.role}),e.jsx("td",{className:"px-3 py-2 border",children:l.firstName}),e.jsx("td",{className:"px-3 py-2 border",children:l.lastName}),e.jsx("td",{className:"px-3 py-2 border",children:l.mobileNumber}),e.jsx("td",{className:"px-3 py-2 border",children:l.mobileVerified?"✅":"❌"}),e.jsxs("td",{className:"px-3 py-2 border flex flex-wrap justify-center gap-1",children:[e.jsx("button",{onClick:()=>j(l),className:"text-blue-500 underline",children:"Edit"}),e.jsx("button",{onClick:()=>x(l.email,l.role==="admin"?"user":"admin"),className:"text-yellow-600 underline",children:"Toggle Role"}),e.jsx("button",{onClick:()=>l.blocked?h(l.email):t(l.email),className:"text-purple-600 underline",children:l.blocked?"Unblock":"Block"}),e.jsx("button",{onClick:()=>u(l.email),className:"text-green-600 underline",children:"Verify"}),e.jsx("button",{onClick:()=>p(l.email),className:"text-red-600 underline",children:"Delete"})]})]},l.email))})]})}):e.jsx("div",{className:"text-center",children:"No users found."})}const X=()=>{const[a,o]=i.useState(""),[x,t]=i.useState(""),[h,p]=i.useState(""),[u,j]=i.useState(""),[l,C]=i.useState(""),[s,m]=i.useState(""),[b,k]=i.useState([{color:"",sku:"",imageFile:null}]),[N,S]=i.useState(!1),A=()=>{k(c=>[...c,{color:"",sku:"",imageFile:null}])},F=(c,f,w)=>{const r=[...b];r[c][f]=w,k(r)},P=c=>{k(f=>f.filter((w,r)=>r!==c))},V=async c=>{if(c.preventDefault(),!a||!h||!s){d.error("Name, Price & SKU are required.");return}S(!0);try{const f=parseFloat(u)||0,w=parseInt(l,10)||0,r=new FormData;r.append("name",a),r.append("description",x),r.append("price",h),r.append("discount",f),r.append("quantity",w),r.append("sku",s),r.append("variants",JSON.stringify(b.map(n=>({color:n.color,sku:n.sku})))),b.forEach(n=>{n.imageFile&&r.append("variantImages",n.imageFile)});const y=await U.post("/api/admin/stationery/add",r,{headers:{"Content-Type":"multipart/form-data"}});d.success(y.data.message||"Product uploaded successfully!"),o(""),t(""),p(""),j(""),C(""),m(""),k([{color:"",sku:"",imageFile:null}])}catch(f){console.error(f),d.error("Failed to upload product. Please try again.")}finally{S(!1)}};return e.jsxs("div",{className:"p-6 max-w-3xl mx-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"➕ Add Stationery Product"}),e.jsxs("form",{onSubmit:V,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name *",className:"w-full p-2 border rounded",value:a,onChange:c=>o(c.target.value)}),e.jsx("textarea",{placeholder:"Short Description",className:"w-full p-2 border rounded",value:x,onChange:c=>t(c.target.value)}),e.jsx("input",{type:"text",placeholder:"SKU *",className:"w-full p-2 border rounded",value:s,onChange:c=>m(c.target.value)}),e.jsx("input",{type:"number",placeholder:"Price (₹) *",className:"w-full p-2 border rounded",value:h,onChange:c=>p(c.target.value)}),e.jsx("input",{type:"number",placeholder:"Discount (%)",className:"w-full p-2 border rounded",value:u,onChange:c=>j(c.target.value)}),e.jsx("input",{type:"number",placeholder:"Quantity *",className:"w-full p-2 border rounded",value:l,onChange:c=>C(c.target.value),min:0}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Variants"}),b.map((c,f)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"text",placeholder:"Color",className:"border p-1 rounded flex-1",value:c.color,onChange:w=>F(f,"color",w.target.value)}),e.jsx("input",{type:"text",placeholder:"Variant SKU",className:"border p-1 rounded flex-1",value:c.sku,onChange:w=>F(f,"sku",w.target.value)}),e.jsx("input",{type:"file",accept:"image/*",onChange:w=>F(f,"imageFile",w.target.files[0])}),e.jsx("button",{type:"button",onClick:()=>P(f),className:"text-red-600",children:"✕"})]},f)),e.jsx("button",{type:"button",onClick:A,className:"text-blue-600",children:"+ Add Variant"})]}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",disabled:N,children:N?"Uploading...":"Upload Product"})]})]})},Y=({product:a,onClose:o,onUpdate:x})=>{const[t,h]=i.useState(""),[p,u]=i.useState(""),[j,l]=i.useState(""),[C,s]=i.useState(""),[m,b]=i.useState(""),[k,N]=i.useState(0),[S,A]=i.useState([]),[F,P]=i.useState([]),[V,c]=i.useState(!1);i.useEffect(()=>{a&&(h(a.name||""),u(a.description||""),l(a.price||""),s(a.discount||""),b(a.sku||""),N(a.quantity||0),A(Array.isArray(a.images)?a.images:[]),P([]))},[a]);const f=r=>{A(y=>y.filter((n,g)=>g!==r))},w=async r=>{if(r.preventDefault(),!t||!j||!m){d.error("Name, price, and SKU are required");return}const y=new FormData;y.append("name",t),y.append("description",p),y.append("price",j),y.append("discount",C),y.append("sku",m),y.append("quantity",k),y.append("existing",JSON.stringify(S)),F.forEach(n=>y.append("images",n));try{c(!0);const n=await U.put(`/api/admin/stationery/update/${a.id}`,y,{headers:{"Content-Type":"multipart/form-data"}});d.success(n.data.message||"Product updated"),o(),x()}catch(n){console.error(n),d.error("Failed to update product")}finally{c(!1)}};return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-xl",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Edit Product"}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsx("input",{type:"text",className:"w-full border p-2 rounded",value:t,onChange:r=>h(r.target.value),placeholder:"Product name"}),e.jsx("textarea",{className:"w-full border p-2 rounded",value:p,onChange:r=>u(r.target.value),placeholder:"Description"}),e.jsx("input",{type:"text",className:"w-full border p-2 rounded",value:m,onChange:r=>b(r.target.value),placeholder:"SKU"}),e.jsx("input",{type:"number",className:"w-full border p-2 rounded",value:j,onChange:r=>l(r.target.value),placeholder:"Price"}),e.jsx("input",{type:"number",className:"w-full border p-2 rounded",value:C,onChange:r=>s(r.target.value),placeholder:"Discount (%)"}),e.jsx("input",{type:"number",className:"w-full border p-2 rounded",value:k,onChange:r=>N(parseInt(r.target.value,10)),placeholder:"Quantity",min:"0"}),S.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-2",children:S.map((r,y)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:r,alt:"existing",className:"w-24 h-24 object-cover rounded"}),e.jsx("button",{type:"button",className:"absolute top-0 right-0 bg-red-600 text-white text-xs px-1 rounded",onClick:()=>f(y),children:"✕"})]},y))}),e.jsx("input",{type:"file",className:"w-full border p-2 rounded",onChange:r=>P(Array.from(r.target.files)),multiple:!0,accept:"image/*"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",disabled:V,children:V?"Saving...":"Save Changes"}),e.jsx("button",{type:"button",className:"px-4 py-2 border rounded",onClick:o,children:"Cancel"})]})]})]})}):null};function Z(){const[a,o]=i.useState([]),[x,t]=i.useState(!1),[h,p]=i.useState(null),u=async()=>{t(!0);try{const s=await U.get("/api/stationery/products");o(Array.isArray(s.data.products)?s.data.products:[])}catch(s){console.error("❌ Failed to load products:",s),d.error("Failed to load stationery.")}finally{t(!1)}};i.useEffect(()=>{u()},[]);const j=async s=>{if(window.confirm("Delete this product?"))try{await U.delete(`/api/admin/stationery/delete/${s}`),d.success("Product deleted"),u()}catch(m){console.error("❌ Failed to delete product:",m),d.error("Delete failed")}},l=async(s,m)=>{try{await U.put(`/api/admin/stationery/product/${s}/sku`,{sku:m}),u(),d.success("SKU updated")}catch{d.error("SKU update failed")}},C=async(s,m)=>{const b=parseInt(m,10);if(!(isNaN(b)||b<0))try{await U.put(`/api/admin/stationery/product/${s}/quantity`,{quantity:b}),u(),d.success("Quantity updated")}catch{d.error("Quantity update failed")}};return e.jsxs("div",{className:"mt-10",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"📦 All Stationery Products"}),x?e.jsx("div",{children:"Loading…"}):e.jsx("div",{className:"overflow-x-auto bg-white shadow rounded",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 border",children:"#"}),e.jsx("th",{className:"px-4 py-2 border",children:"Image"}),e.jsx("th",{className:"px-4 py-2 border",children:"Name"}),e.jsx("th",{className:"px-4 py-2 border",children:"SKU"}),e.jsx("th",{className:"px-4 py-2 border",children:"Price"}),e.jsx("th",{className:"px-4 py-2 border",children:"Quantity"}),e.jsx("th",{className:"px-4 py-2 border",children:"Variants"}),e.jsx("th",{className:"px-4 py-2 border",children:"Actions"})]})}),e.jsx("tbody",{children:a.map((s,m)=>{const b=Array.isArray(s.images)?s.images:[],k=Array.isArray(s.variants)?s.variants:[];return e.jsxs("tr",{className:"text-center",children:[e.jsx("td",{className:"px-4 py-2 border",children:m+1}),e.jsx("td",{className:"px-4 py-2 border",children:b.length>0?e.jsx("img",{src:b[0],alt:s.name,className:"w-16 h-16 object-cover mx-auto"}):"No image"}),e.jsx("td",{className:"px-4 py-2 border",children:s.name}),e.jsx("td",{className:"px-4 py-2 border",children:e.jsx("input",{type:"text",className:"w-full p-1 border rounded text-sm",value:s.sku||"",onChange:N=>l(s.id,N.target.value)})}),e.jsxs("td",{className:"px-4 py-2 border",children:["₹",s.price.toFixed(2)]}),e.jsx("td",{className:"px-4 py-2 border",children:e.jsx("input",{type:"number",min:"0",className:"w-full p-1 border rounded text-sm",value:s.quantity,onChange:N=>C(s.id,N.target.value)})}),e.jsx("td",{className:"px-4 py-2 border",children:e.jsx("div",{className:"flex justify-center space-x-2",children:k.map(N=>e.jsx("img",{src:N.imageUrl,title:N.color,className:"w-6 h-6 rounded-full border border-gray-300 hover:border-blue-500 cursor-pointer"},N.sku))})}),e.jsxs("td",{className:"px-4 py-2 border space-x-2",children:[e.jsx("button",{onClick:()=>p(s),className:"bg-gray-500 text-white px-2 py-1 rounded text-xs",children:"Edit"}),e.jsx("button",{onClick:()=>j(s.id),className:"bg-red-500 text-white px-2 py-1 rounded text-xs",children:"Delete"})]})]},s.id)})})]})}),h&&e.jsx(Y,{product:h,onClose:()=>p(null),onUpdate:()=>{p(null),u()}})]})}function ee({editUser:a,setEditUser:o,handleEditUser:x,saving:t}){if(!a)return null;const h=p=>{const u=p.target.checked;o(j=>({...j,mobileVerified:u?1:0}))};return e.jsxs("div",{className:"fixed top-10 right-10 bg-white p-4 shadow rounded-lg w-96 space-y-2",children:[e.jsx("h2",{className:"font-bold text-lg mb-2",children:"Edit User"}),e.jsx("input",{type:"text",value:a.email||"",disabled:!0,className:"w-full border p-2 rounded bg-gray-100",placeholder:"Email (readonly)"}),e.jsx("input",{type:"text",value:a.firstName||"",onChange:p=>o(u=>({...u,firstName:p.target.value})),placeholder:"First Name",className:"w-full border p-2 rounded"}),e.jsx("input",{type:"text",value:a.lastName||"",onChange:p=>o(u=>({...u,lastName:p.target.value})),placeholder:"Last Name",className:"w-full border p-2 rounded"}),e.jsx("input",{type:"text",value:a.mobileNumber||"",onChange:p=>o(u=>({...u,mobileNumber:p.target.value})),placeholder:"Mobile Number",className:"w-full border p-2 rounded"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.mobileVerified===1,onChange:h}),e.jsx("label",{children:"Mobile Verified"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:x,disabled:t,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded disabled:opacity-50",children:t?"Saving...":"Save"}),e.jsx("button",{onClick:()=>o(null),className:"bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded",children:"Cancel"})]})]})}const ae=async()=>(await U.get("/api/get-orders")).data,te=async(a,o)=>{await U.post("/api/update-order-status",{orderId:a,newStatus:o})};function de(){const a=L(),[o,x]=i.useState(!0),[t,h]=i.useState("orders"),[p,u]=i.useState([]),[j,l]=i.useState([]),[C,s]=i.useState(!1),[m,b]=i.useState(null),[k,N]=i.useState(!1);i.useEffect(()=>{(async()=>{try{await S()}finally{x(!1)}})()},[]);const S=async()=>{s(!0);try{const{orders:n}=await ae();u(n)}catch{d.error("Failed to load orders")}finally{s(!1)}},A=async()=>{s(!0);try{const{users:n}=await R();l(n)}catch{d.error("Failed to load users")}finally{s(!1)}},F=async()=>{await O(I),a("/login")},P=()=>a("/userdashboard"),V=async()=>{if(m){N(!0);try{await $(m),l(n=>n.map(g=>g.email===m.email?m:g)),d.success("User profile updated"),b(null)}catch{d.error("Failed to update user profile")}finally{N(!1)}}},c=async(n,g)=>{try{await B(n,g),l(v=>v.map(D=>D.email===n?{...D,role:g}:D)),d.success(`User role changed to ${g}`)}catch{d.error("Failed to change user role")}},f=async n=>{try{const g=j.find(v=>v.email===n);if((g==null?void 0:g.role)==="admin"){d.error("Cannot block an admin user");return}await K(n),l(v=>v.map(D=>D.email===n?{...D,blocked:!0}:D)),d.success("User blocked")}catch{d.error("Failed to block user")}},w=async n=>{try{await T(n),l(g=>g.map(v=>v.email===n?{...v,blocked:!1}:v)),d.success("User unblocked")}catch{d.error("Failed to unblock user")}},r=async n=>{try{await W(n),l(g=>g.map(v=>v.email===n?{...v,mobileVerified:v.mobileVerified?0:1}:v)),d.success("Mobile verification status toggled")}catch{d.error("Failed to verify mobile")}},y=async n=>{if(window.confirm("Are you sure you want to delete this user?"))try{await _(n),l(g=>g.filter(v=>v.email!==n)),d.success("User deleted")}catch{d.error("Failed to delete user")}};return o?e.jsx("div",{className:"text-center mt-10",children:"Checking login…"}):e.jsxs(q,{title:"Admin Dashboard",children:[e.jsx(M,{}),e.jsx(Q,{}),e.jsxs("div",{className:"flex justify-end gap-2 mb-6",children:[e.jsx(E,{variant:"secondary",onClick:P,children:"Back to User View"}),e.jsx(E,{variant:"danger",onClick:F,children:"Logout"})]}),e.jsx(J,{activeTab:t,setActiveTab:h,fetchOrders:S,fetchUsers:A}),e.jsxs("div",{className:"mt-6 p-6 bg-white rounded shadow overflow-auto min-h-[60vh]",children:[t==="orders"&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Manage Orders"}),e.jsx(H,{orders:p,loading:C,handleStatusChange:te})]}),t==="users"&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Manage Users"}),e.jsx(G,{users:j,loading:C,handleRoleChange:c,handleBlockUser:f,handleUnblockUser:w,handleDeleteUser:y,handleVerifyMobile:r,setEditUser:b}),m&&e.jsx(ee,{editUser:m,setEditUser:b,handleEditUser:V,saving:k})]}),t==="stationery"&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Manage Stationery"}),e.jsx(X,{}),e.jsx(Z,{})]})]})]})}export{de as default};
