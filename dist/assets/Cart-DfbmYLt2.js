import{c as Q,r as c,j as e,O as U,Q as L,V as h,d as w}from"./vendor-JV4b0bO8.js";import{u as M,a as $}from"./index-DwOsTwTZ.js";import{L as z,B as l}from"./Button-C4S57wnW.js";function K(){const x=Q(),{cartItems:y,clearCart:B,removeFromCart:P}=M(),r=Array.isArray(y.print)?y.print:[],n=Array.isArray(y.stationery)?y.stationery:[],[I,A]=c.useState([]),[R,E]=c.useState([]),[b,q]=c.useState(!1),[S,v]=c.useState(!1),[f,O]=c.useState("0.00"),[g,k]=c.useState(""),[D,F]=c.useState(!1);c.useEffect(()=>{if(b)return;const s=r.reduce((i,d)=>i+(d.totalCost||0),0),a=n.reduce((i,d)=>i+parseFloat(d.finalPrice||0),0),C=s+a;let m="ORD0000";[...r,...n].forEach(i=>{i.orderNumber&&(m=i.orderNumber)}),O(C.toFixed(2)),k(m)},[r,n,b]);const V=async()=>{var s;if(!r.length&&!n.length){h.error("Your cart is empty.");return}v(!0);try{const a=r.reduce((t,p)=>t+(p.totalCost||0),0),C=n.reduce((t,p)=>t+parseFloat(p.finalPrice||0),0),m=a+C,i=((s=$.currentUser)==null?void 0:s.email)||"",d=new Date().toISOString();let j;if(r.length){const t=new FormData;t.append("user",i),t.append("totalCost",m),t.append("createdAt",d),t.append("printType",r[0].printType),t.append("sideOption",r[0].sideOption),t.append("spiralBinding",r[0].spiralBinding?"true":"false");const p=r.map(o=>o.files.map(N=>N.pages));t.append("pageCounts",JSON.stringify(p)),r.forEach(o=>o.files.forEach(N=>t.append("files",N.raw,N.name))),n.length&&t.append("items",JSON.stringify(n.map(o=>({id:o.id,name:o.name,quantity:o.quantity||1,price:o.finalPrice})))),j=(await w.post("/api/submit-order",t,{headers:{"Content-Type":"multipart/form-data"}})).data}else{const t={user:i,items:n.map(u=>({id:u.id,name:u.name,quantity:u.quantity||1,price:u.finalPrice})),totalCost:m,createdAt:d};j=(await w.post("/api/submit-stationery-order",t)).data}A(r),E(n),k(j.orderNumber),O(Number(j.totalCost).toFixed(2)),h.success("âœ… Order placed! Scan to pay now."),q(!0),B()}catch(a){console.error("Order submission error:",a),h.error("âŒ Order submission failed.")}finally{v(!1)}},Y=async()=>{F(!0);try{await w.post("/api/confirm-payment",{orderNumber:g}),h.success("ðŸ™ Payment confirmed! Confirmation email on its way.")}catch(s){console.error("Payment confirmation error:",s),h.error("âŒ Could not confirm payment.")}},T=`upi://pay?pa=9518916780@okbizaxis&pn=MVPS+Printing&am=${f}&tn=${encodeURIComponent(g)}`;return e.jsxs(z,{title:"Cart Summary",children:[e.jsx(U,{}),b?e.jsxs("div",{className:"space-y-4 max-w-3xl mx-auto",children:[I.map((s,a)=>e.jsxs("div",{className:"bg-white shadow rounded p-4",children:[e.jsx("p",{className:"font-semibold",children:"PRINT"}),e.jsxs("p",{children:["Cost: â‚¹",s.totalCost]}),e.jsxs("p",{className:"text-sm",children:["Type: ",s.printType==="color"?"Color":"B/W",","," ",s.sideOption==="double"?"Back-to-Back":"Single-Sided",", Spiral: ",s.spiralBinding?"Yes":"No"]})]},a)),R.map((s,a)=>e.jsxs("div",{className:"bg-white shadow rounded p-4 flex justify-between",children:[e.jsx("p",{className:"font-semibold",children:"STATIONERY"}),e.jsxs("p",{children:[s.name," (â‚¹",s.finalPrice,") Ã—",s.quantity||1]})]},a)),e.jsxs("p",{className:"text-right font-semibold",children:["Total: â‚¹",f]}),e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("p",{className:"font-medium",children:["Scan to pay â‚¹",f," (Order: ",g,")"]}),e.jsx(L,{value:T,size:180,className:"mx-auto"}),e.jsx("a",{href:T,className:"block underline",children:"Open in Payment App"}),D?e.jsx("p",{className:"text-green-600 font-semibold",children:"Payment confirmedâ€”thank you!"}):e.jsx(l,{onClick:Y,className:"bg-green-600 hover:bg-green-700",children:"Iâ€™ve completed the payment"})]}),e.jsxs("div",{className:"flex justify-between mt-10",children:[e.jsx(l,{onClick:()=>x("/userdashboard"),className:"underline",children:"â† Back to Dashboard"}),e.jsx(l,{onClick:()=>x("/orders"),className:"underline",children:"View My Orders â†’"})]})]}):e.jsxs("div",{className:"space-y-4 max-w-3xl mx-auto",children:[r.map((s,a)=>e.jsxs("div",{className:"bg-white shadow rounded p-4 flex justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"PRINT"}),e.jsxs("p",{children:["Cost: â‚¹",s.totalCost]}),e.jsxs("p",{className:"text-sm",children:["Type: ",s.printType==="color"?"Color":"B/W",","," ",s.sideOption==="double"?"Back-to-Back":"Single-Sided",", Spiral: ",s.spiralBinding?"Yes":"No"]})]}),e.jsx(l,{onClick:()=>P("print",a),className:"bg-red-500 hover:bg-red-600 text-white",children:"Remove"})]},a)),n.map((s,a)=>e.jsxs("div",{className:"bg-white shadow rounded p-4 flex justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"STATIONERY"}),e.jsxs("p",{children:[s.name," (â‚¹",s.finalPrice,") Ã—",s.quantity||1]})]}),e.jsx(l,{onClick:()=>P("stationery",a),className:"bg-red-500 hover:bg-red-600 text-white",children:"Remove"})]},a)),e.jsxs("p",{className:"text-right font-semibold",children:["Total: â‚¹",f]}),e.jsx("div",{className:"text-center mt-6",children:e.jsx(l,{onClick:V,disabled:S,className:"bg-purple-600 hover:bg-purple-700 w-full",children:S?"Processingâ€¦":"Proceed to Pay via UPI"})}),e.jsxs("div",{className:"flex justify-between mt-10",children:[e.jsx(l,{onClick:()=>x("/userdashboard"),className:"underline",children:"â† Back to Dashboard"}),e.jsx(l,{onClick:()=>x("/orders"),className:"underline",children:"View My Orders â†’"})]})]})]})}export{K as default};
