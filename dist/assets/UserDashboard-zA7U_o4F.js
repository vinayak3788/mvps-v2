import{r as c,j as e,P as C,V as g,d as v,c as S,O,l as P}from"./vendor-JV4b0bO8.js";import{u as w,a as N}from"./index-DwOsTwTZ.js";import{L as F,B as f}from"./Button-C4S57wnW.js";import{U as A}from"./UserHeader-C593a15d.js";function U({files:t,setFiles:d}){const{addToCart:l}=w(),[m,j]=c.useState("bw"),[h,x]=c.useState("single"),[u,o]=c.useState(!1),b=async n=>{const s=Array.from(n.target.files).filter(a=>a.name.toLowerCase().endsWith(".pdf")),r=await Promise.all(s.map(async a=>{try{const i=await a.arrayBuffer(),k=await C.load(i);return{name:a.name,pages:k.getPageCount(),raw:a}}catch{return g.error(`Error reading ${a.name}`),{name:a.name,pages:0,raw:a}}}));d(r)},p=()=>{const n=m==="color"?5:2;let s=t.reduce((r,a)=>r+(a.pages||0)*n,0);return u&&(s+=30),s},y=()=>{var r;if(!t.length||t.some(a=>!a.pages)){g.error("Please wait for page counts on all PDFs.");return}const s={type:"print",user:(r=N.currentUser)==null?void 0:r.email,printType:m,sideOption:h,spiralBinding:u,totalCost:p(),createdAt:new Date().toISOString(),files:t.map(a=>({name:a.name,pages:a.pages,raw:a.raw}))};l("print",s),g.success("🛒 Added to cart!"),d([])};return e.jsxs("div",{className:"bg-white p-6 rounded shadow max-w-2xl mx-auto mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Place Your Print Order"}),e.jsx("label",{className:"block font-medium mb-1",children:"Upload PDF(s)"}),e.jsx("input",{type:"file",accept:".pdf",multiple:!0,onChange:b}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-1",children:"Print Type:"}),e.jsxs("label",{className:"block",children:[e.jsx("input",{type:"radio",name:"printType",value:"bw",checked:m==="bw",onChange:()=>j("bw")})," ","B/W (₹2/page)"]}),e.jsxs("label",{className:"block",children:[e.jsx("input",{type:"radio",name:"printType",value:"color",checked:m==="color",onChange:()=>j("color")})," ","Color (₹5/page)"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-1",children:"Print Side:"}),e.jsxs("label",{className:"block",children:[e.jsx("input",{type:"radio",name:"sideOption",value:"single",checked:h==="single",onChange:()=>x("single")})," ","Single Sided"]}),e.jsxs("label",{className:"block",children:[e.jsx("input",{type:"radio",name:"sideOption",value:"double",checked:h==="double",onChange:()=>x("double")})," ","Back to Back"]})]})]}),e.jsx("div",{className:"mt-3",children:e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:()=>o(n=>!n)}),e.jsx("span",{className:"ml-2 font-medium",children:"Add Spiral Binding (₹30)"})]})}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Uploaded Files"}),e.jsxs("table",{className:"w-full border text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-200",children:[e.jsx("th",{className:"text-left p-2",children:"File"}),e.jsx("th",{className:"text-right p-2",children:"Pages"})]})}),e.jsx("tbody",{children:t.map((n,s)=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-2",children:n.name}),e.jsx("td",{className:"text-right p-2",children:n.pages||"Loading..."})]},s))})]})]}),e.jsxs("p",{className:"mt-4 font-bold text-right",children:["Total Cost: ₹",p()]}),e.jsx("button",{onClick:y,className:"mt-4 bg-black text-white px-4 py-2 rounded hover:bg-gray-800 w-full",disabled:!t.length||t.some(n=>!n.pages),children:"🛒 Add to Cart"})]})}function T({myOrders:t,ordersLoading:d}){return e.jsxs("div",{className:"bg-white p-6 rounded shadow max-w-5xl mx-auto",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"My Previous Orders"}),d?e.jsx("div",{className:"text-center",children:"Loading orders..."}):t.length===0?e.jsx("div",{className:"text-center text-gray-500",children:"No past orders found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-200",children:[e.jsx("th",{className:"p-2",children:"Order No"}),e.jsx("th",{className:"p-2",children:"Files"}),e.jsx("th",{className:"p-2",children:"Total Pages"}),e.jsx("th",{className:"p-2",children:"Cost"}),e.jsx("th",{className:"p-2",children:"Status"}),e.jsx("th",{className:"p-2",children:"Date"})]})}),e.jsx("tbody",{children:t.map(l=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-2",children:l.orderNumber}),e.jsx("td",{className:"p-2",children:l.fileNames}),e.jsx("td",{className:"p-2",children:l.totalPages}),e.jsxs("td",{className:"p-2",children:["₹",l.totalCost]}),e.jsx("td",{className:"p-2",children:l.status}),e.jsx("td",{className:"p-2",children:new Date(l.createdAt).toLocaleString()})]},l.id))})]})})]})}function L(){const{addToCart:t}=w(),[d,l]=c.useState([]),[m,j]=c.useState(!0),[h,x]=c.useState({}),[u,o]=c.useState(null);c.useEffect(()=>{b()},[]);const b=async()=>{try{const s=await v.get("/api/stationery/products"),r=Array.isArray(s.data.products)?s.data.products:[];l(r);const a={};r.forEach(i=>{a[i.id]=Array.isArray(i.variants)&&i.variants.length>0?i.variants[0]:{color:null,sku:i.sku,imageUrl:i.images[0]}}),x(a)}catch(s){console.error("❌ Error fetching stationery products:",s),g.error("Failed to load stationery.")}finally{j(!1)}},p=(s,r)=>{x(a=>({...a,[s]:r}))},y=s=>{const r=h[s.id]||{},a=`Order${Date.now().toString().slice(-6)}`,i=s.discount>0?parseFloat(s.price-s.price*s.discount/100).toFixed(2):s.price.toFixed(2);t("stationery",{type:"stationery",orderNumber:a,id:s.id,name:s.name,price:s.price,discount:s.discount,finalPrice:i,quantity:1,variantSku:r.sku,variantColor:r.color}),g.success(`🛒 ${s.name} added to cart`)};if(m)return e.jsx("div",{className:"text-center mt-10",children:"Loading products..."});if(!d.length)return e.jsx("div",{className:"text-center mt-10",children:"No stationery products available yet."});const n=u?d.find(s=>s.id===u):null;return e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-center mb-8",children:"🛒 Stationery Store"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:d.map(s=>{const r=Array.isArray(s.images)?s.images:[],a=h[s.id]||{};return e.jsxs("div",{className:"border rounded-lg overflow-hidden shadow hover:shadow-lg transition-all flex flex-col bg-white",children:[s.variants&&s.variants.length>0&&e.jsx("div",{className:"flex justify-center p-2 space-x-2",children:s.variants.map(i=>e.jsx("img",{src:i.imageUrl,alt:i.color,title:i.color,className:`w-8 h-8 object-cover rounded-full cursor-pointer border-2 ${a.sku===i.sku?"border-blue-600":"border-gray-300"}`,onClick:()=>p(s.id,i)},i.sku))}),e.jsx("div",{className:"w-full h-48 bg-gray-100 flex items-center justify-center cursor-pointer",onClick:()=>o(s.id),children:a.imageUrl?e.jsx("img",{src:a.imageUrl,alt:s.name,className:"object-contain h-full"}):r.length>0?e.jsx("img",{src:r[0],alt:s.name,className:"object-contain h-full"}):e.jsx("span",{className:"text-gray-400",children:"No Image"})}),e.jsxs("div",{className:"p-4 flex-1 flex flex-col",children:[e.jsx("h3",{className:"text-lg font-semibold mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:s.description}),s.discount>0?e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsxs("span",{className:"text-green-600 font-bold",children:["₹",s.discount>0?parseFloat(s.price-s.price*s.discount/100).toFixed(2):s.price.toFixed(2)]}),e.jsxs("span",{className:"line-through text-gray-500",children:["₹",s.price.toFixed(2)]}),e.jsxs("span",{className:"text-red-500 text-sm",children:["(",s.discount,"% OFF)"]})]}):e.jsxs("div",{className:"text-black font-bold mb-2",children:["₹",s.price.toFixed(2)]}),e.jsxs("div",{className:"text-sm text-gray-700 mb-4",children:["SKU: ",a.sku||s.sku,e.jsx("br",{}),"In stock: ",s.quantity]}),e.jsx("button",{onClick:()=>y(s),disabled:s.quantity===0,className:"mt-auto bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition disabled:opacity-50",children:s.quantity===0?"Out of stock":"➕ Add to Cart"})]})]},s.id)})}),n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-4 rounded shadow-lg max-w-sm w-full",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Choose a color"}),e.jsx("div",{className:"flex space-x-2",children:n.variants.map(s=>e.jsx("img",{src:s.imageUrl,title:s.color,className:"w-12 h-12 object-cover rounded-full cursor-pointer border-2 border-gray-300 hover:border-blue-600",onClick:()=>{p(n.id,s),o(null)}},s.sku))}),e.jsx("button",{className:"mt-4 text-sm text-gray-600",onClick:()=>o(null),children:"Cancel"})]})})]})}function D(){const[t,d]=c.useState([]),[l,m]=c.useState([]),[j,h]=c.useState(!0);return{files:t,setFiles:d,myOrders:l,fetchMyOrders:async u=>{try{const o=await v.get("/api/get-orders",{params:{email:u}});m(o.data.orders||[])}catch(o){console.error("❌ Error fetching orders",o),g.error("Failed to fetch your orders.")}finally{h(!1)}},ordersLoading:j}}function I(){const t=S(),[d,l]=c.useState(!0),{files:m,setFiles:j,myOrders:h,fetchMyOrders:x,ordersLoading:u}=D(),[o,b]=c.useState("orders");c.useEffect(()=>{(async()=>{const s=N.currentUser;if(!s){t("/login",{replace:!0});return}try{await x(s.email)}finally{l(!1)}})()},[x,t]);const p=async()=>{await P(N),t("/login",{replace:!0})},y=()=>t("/cart"),n=async()=>{const s=N.currentUser;if(!s){g.error("User not logged in.");return}try{await s.getIdToken(!0),(await v.get(`/api/get-role?email=${s.email}`)).data.role==="admin"||s.email==="vinayak3788@gmail.com"?t("/admin"):g.error("Access denied. You are not an admin.")}catch(r){console.error("Admin access check failed",r),g.error("Could not verify role. Try again.")}};return d?e.jsx("div",{className:"text-center mt-10",children:"Checking login…"}):e.jsxs(F,{title:"MVPS Dashboard",children:[e.jsx(O,{}),e.jsx(A,{}),e.jsxs("div",{className:"flex flex-wrap justify-end gap-2 mb-6",children:[e.jsx(f,{variant:"secondary",onClick:y,children:"View Cart"}),e.jsx(f,{variant:"primary",onClick:n,children:"Switch to Admin"}),e.jsx(f,{variant:"danger",onClick:p,children:"Logout"})]}),e.jsxs("div",{className:"flex justify-center gap-4 mb-6",children:[e.jsx(f,{variant:o==="orders"?"primary":"secondary",onClick:()=>b("orders"),children:"📄 Print Orders"}),e.jsx(f,{variant:o==="stationery"?"primary":"secondary",onClick:()=>b("stationery"),children:"🛒 Stationery Orders"})]}),o==="orders"?e.jsxs(e.Fragment,{children:[e.jsx(U,{files:m,setFiles:j,fetchMyOrders:x}),e.jsx(T,{myOrders:h,ordersLoading:u})]}):e.jsx(L,{})]})}export{I as default};
